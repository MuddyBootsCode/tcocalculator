<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Software Development TCO Calculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .variables-section {
            background-color: #e8f4f8;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        .variables-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .variable-group {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #2196F3;
        }
        .variable-group h4 {
            margin: 0 0 10px 0;
            color: #1976D2;
        }
        .input-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .input-row label {
            font-size: 14px;
            color: #555;
        }
        .input-row input, .input-row select {
            width: 80px;
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: right;
        }
        .input-row select {
            width: auto;
            text-align: left;
        }
        .team-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 12px;
        }
        .team-input {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .team-input label {
            font-size: 14px;
            color: #555;
            margin-right: 8px;
        }
        .team-input input {
            width: 70px;
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: right;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #333;
        }
        .number {
            text-align: right;
            font-family: 'Courier New', monospace;
        }
        .total-row {
            background-color: #fff3cd;
            font-weight: bold;
        }
        .section-header {
            background-color: #2196F3;
            color: white;
        }
        .currency {
            color: #2e7d32;
        }
        h1 {
            color: #1976D2;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #333;
            border-bottom: 2px solid #2196F3;
            padding-bottom: 5px;
        }
        .summary-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }
        .summary-amount {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }
        .summary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .summary-item {
            text-align: center;
        }
        .summary-item h3 {
            margin: 0 0 10px 0;
            font-size: 1.1em;
            opacity: 0.9;
        }
        .summary-item .value {
            font-size: 1.8em;
            font-weight: bold;
        }
        .chart-container {
            margin: 30px 0;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .chart-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }
        .chart-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .chart-box h3 {
            margin: 0 0 20px 0;
            color: #1976D2;
            font-size: 1.2em;
        }
        canvas {
            max-height: 300px;
        }
        .user-cost-analysis {
            margin: 30px 0;
        }
        .user-cost-analysis table {
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        .positive {
            color: #2e7d32;
        }
        .negative {
            color: #d32f2f;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Software Development TCO Calculator</h1>
        
        <div class="variables-section">
            <h2>üìä Scenario Variables</h2>
            <div class="variables-grid">
                <div class="variable-group">
                    <h4>üë• Team Composition & Daily Rates</h4>
                    <div class="input-row">
                        <label>Number of Experts:</label>
                        <input type="number" id="numExperts" value="1" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Expert Daily Rate ($):</label>
                        <input type="number" id="expertRate" value="2250" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Number of Engineers:</label>
                        <input type="number" id="numEngineers" value="1" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Engineer Daily Rate ($):</label>
                        <input type="number" id="engineerRate" value="2000" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Number of Frontend Engineers:</label>
                        <input type="number" id="numFrontendEngineers" value="2" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Frontend Engineer Daily Rate ($):</label>
                        <input type="number" id="frontendRate" value="1500" onchange="calculateTCO()">
                    </div>
                </div>
                
                <div class="variable-group">
                    <h4>‚åö Individual Weekly Hours (MVP Phase)</h4>
                    <div class="input-row">
                        <label>Expert Hours/Week (per person):</label>
                        <input type="number" id="expertHours" value="20" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Engineer Hours/Week (per person):</label>
                        <input type="number" id="engineerHours" value="20" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Frontend Engineer Hours/Week (per person):</label>
                        <input type="number" id="frontendHours" value="20" onchange="calculateTCO()">
                    </div>
                </div>
                
                <div class="variable-group">
                    <h4>‚è±Ô∏è Time Parameters</h4>
                    <div class="input-row">
                        <label>MVP Duration (months):</label>
                        <input type="number" id="mvpDuration" value="6" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Working Days/Month:</label>
                        <input type="number" id="workingDays" value="21" onchange="calculateTCO()">
                    </div>
                </div>
                
                <div class="variable-group">
                    <h4>üîß Individual Ongoing Maintenance (Post-MVP)</h4>
                    <div class="input-row">
                        <label>Expert Hours/Month (per person):</label>
                        <input type="number" id="expertMaintenanceHours" value="15" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Engineer Hours/Month (per person):</label>
                        <input type="number" id="engineerMaintenanceHours" value="20" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Frontend Engineer Hours/Month (per person):</label>
                        <input type="number" id="frontendMaintenanceHours" value="17" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Maintenance Rate vs Dev Rate (%):</label>
                        <input type="number" id="maintenanceRateMultiplier" value="85" onchange="calculateTCO()">
                    </div>
                </div>
                
                <div class="variable-group">
                    <h4>üíª Infrastructure Costs</h4>
                    <div class="input-row">
                        <label>Monthly Hosting ($):</label>
                        <input type="number" id="hosting" value="150" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Dev Tools/Year ($):</label>
                        <input type="number" id="devTools" value="3000" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Third-party Services/Month ($):</label>
                        <input type="number" id="thirdParty" value="200" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Software Licenses/Month ($):</label>
                        <input type="number" id="licensing" value="300" onchange="calculateTCO()">
                    </div>
                </div>
                
                <div class="variable-group">
                    <h4>üìà Growth Assumptions</h4>
                    <div class="input-row">
                        <label>Hosting Growth Rate/Year (%):</label>
                        <input type="number" id="hostingGrowth" value="50" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Support Hours Growth/Year (%):</label>
                        <input type="number" id="supportGrowth" value="25" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Licensing Growth Rate/Year (%):</label>
                        <input type="number" id="licensingGrowth" value="20" onchange="calculateTCO()">
                    </div>
                </div>

                <div class="variable-group">
                    <h4>üë§ User & Organization Projections</h4>
                    <div class="input-row">
                        <label>Expected Number of Users:</label>
                        <input type="number" id="expectedUsers" value="1000" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Number of Organizations:</label>
                        <input type="number" id="numOrganizations" value="8" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>User Growth Rate/Year (%):</label>
                        <input type="number" id="userGrowth" value="50" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Organization Growth Rate/Year (%):</label>
                        <input type="number" id="organizationGrowth" value="100" onchange="calculateTCO()">
                    </div>
                </div>

                <div class="variable-group">
                    <h4>üï∏Ô∏è Graph Database Options</h4>
                    <div class="input-row">
                        <label>Graph Database Setup:</label>
                        <select id="graphDbOption" onchange="calculateTCO()">
                            <option value="free">Free Neo4j (Docker/Community)</option>
                            <option value="paid">Paid Neo4j (Discovery Bundle)</option>
                        </select>
                    </div>
                    <div class="input-row">
                        <label>Organizations per Neo4j Instance:</label>
                        <input type="number" id="orgsPerInstance" value="4" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Neo4j Discovery Bundle Cost ($):</label>
                        <input type="number" id="neo4jInstanceCost" value="36000" onchange="calculateTCO()">
                    </div>
                </div>

                <div class="variable-group">
                    <h4>‚òÅÔ∏è Core AWS Services</h4>
                    <div class="input-row">
                        <label>DynamoDB Monthly Cost ($):</label>
                        <input type="number" id="dynamodbCost" value="200" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Cognito Cost per MAU/Month ($):</label>
                        <input type="number" step="0.01" id="cognitoCostPerUser" value="0.05" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Lambda Requests/Month (millions):</label>
                        <input type="number" step="0.1" id="lambdaRequestsPerMonth" value="10" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Lambda Cost per Million Requests ($):</label>
                        <input type="number" step="0.01" id="lambdaCostPerMillion" value="0.20" onchange="calculateTCO()">
                    </div>
                </div>

                <div class="variable-group">
                    <h4>üåê Additional AWS Services</h4>
                    <div class="input-row">
                        <label>API Gateway Requests/Month (millions):</label>
                        <input type="number" step="0.1" id="apiGatewayRequests" value="10" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>API Gateway Cost per Million ($):</label>
                        <input type="number" step="0.01" id="apiGatewayCostPerMillion" value="3.50" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>CloudFront Data Transfer/Month (GB):</label>
                        <input type="number" step="0.1" id="cloudFrontData" value="500" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>CloudFront Cost per GB ($):</label>
                        <input type="number" step="0.001" id="cloudFrontCostPerGB" value="0.085" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>S3 Storage (GB):</label>
                        <input type="number" step="0.1" id="s3Storage" value="100" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>S3 Cost per GB/Month ($):</label>
                        <input type="number" step="0.001" id="s3CostPerGB" value="0.023" onchange="calculateTCO()">
                    </div>
                </div>

                <div class="variable-group">
                    <h4>üìä AWS Monitoring & Messaging</h4>
                    <div class="input-row">
                        <label>CloudWatch Logs Ingested/Month (GB):</label>
                        <input type="number" step="0.1" id="cloudWatchLogs" value="10" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>CloudWatch Cost per GB ($):</label>
                        <input type="number" step="0.01" id="cloudWatchCostPerGB" value="0.50" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>EventBridge Events/Month (millions):</label>
                        <input type="number" step="0.1" id="eventBridgeEvents" value="1" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>EventBridge Cost per Million ($):</label>
                        <input type="number" step="0.01" id="eventBridgeCostPerMillion" value="1.00" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>SQS Messages/Month (millions):</label>
                        <input type="number" step="0.1" id="sqsMessages" value="5" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>SQS Cost per Million Messages ($):</label>
                        <input type="number" step="0.01" id="sqsCostPerMillion" value="0.40" onchange="calculateTCO()">
                    </div>
                </div>

                <div class="variable-group">
                    <h4>üìä AWS Growth Assumptions</h4>
                    <div class="input-row">
                        <label>API/Lambda Usage Growth/Year (%):</label>
                        <input type="number" id="lambdaGrowth" value="40" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Storage Growth Rate/Year (%):</label>
                        <input type="number" id="storageGrowth" value="30" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Data Transfer Growth/Year (%):</label>
                        <input type="number" id="dataTransferGrowth" value="35" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Logs/Monitoring Growth/Year (%):</label>
                        <input type="number" id="logsGrowth" value="25" onchange="calculateTCO()">
                    </div>
                </div>

                <div class="variable-group">
                    <h4>üìä User Behavior & AWS Usage</h4>
                    <div class="input-row">
                        <label>API Requests per User/Month:</label>
                        <input type="number" id="apiRequestsPerUser" value="1000" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Data Transfer per User/Month (MB):</label>
                        <input type="number" step="0.1" id="dataPerUser" value="500" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Storage per User (MB):</label>
                        <input type="number" step="0.1" id="storagePerUser" value="100" onchange="calculateTCO()">
                    </div>
                    <div class="input-row">
                        <label>Active User Rate (%):</label>
                        <input type="number" id="activeUserRate" value="70" onchange="calculateTCO()">
                    </div>
                </div>
            </div>
        </div>

        <div class="summary-box">
            <h2 style="margin: 0; border: none; color: white;">üí∞ 3-Year Total Cost of Ownership</h2>
            <div class="summary-amount" id="totalTCO">$0</div>
            <div class="summary-grid">
                <div class="summary-item">
                    <h3>üìä Cost Per User</h3>
                    <div class="value" id="costPerUser">$0</div>
                </div>
                <div class="summary-item">
                    <h3>üìÖ Monthly Cost Per User</h3>
                    <div class="value" id="monthlyCostPerUser">$0</div>
                </div>
            </div>
        </div>

        <div class="chart-grid">
            <div class="chart-box">
                <h3>üìà Cost Per User Over Time</h3>
                <canvas id="costPerUserChart"></canvas>
            </div>
            <div class="chart-box">
                <h3>üìä Cost Composition Per User</h3>
                <canvas id="costCompositionChart"></canvas>
            </div>
            <div class="chart-box">
                <h3>üìä Cost Drivers Ranking</h3>
                <canvas id="costDriversChart"></canvas>
            </div>
            <div class="chart-box">
                <h3>üìà Users vs Total Cost</h3>
                <canvas id="scaleChart"></canvas>
            </div>
        </div>

        <div class="user-cost-analysis">
            <h2>üìä Cost Per User Analysis</h2>
            <table>
                <thead>
                    <tr class="section-header">
                        <th>User Segment</th>
                        <th>Fixed Cost/User/Month</th>
                        <th>Variable Cost/User/Month</th>
                        <th>Total Cost/User/Month</th>
                        <th>Efficiency vs Base</th>
                    </tr>
                </thead>
                <tbody id="userAnalysisBody">
                </tbody>
            </table>
        </div>

        <h2>üìã Detailed Cost Breakdown</h2>
        <table id="tcoTable">
            <thead>
                <tr class="section-header">
                    <th>Cost Category</th>
                    <th>Year 1</th>
                    <th>Year 2</th>
                    <th>Year 3</th>
                    <th>3-Year Total</th>
                </tr>
            </thead>
            <tbody id="tcoBody">
            </tbody>
        </table>

        <h2>üìä Cost Analysis</h2>
        <table id="analysisTable">
            <thead>
                <tr class="section-header">
                    <th>Metric</th>
                    <th>Value</th>
                </tr>
            </thead>
            <tbody id="analysisBody">
            </tbody>
        </table>
    </div>

    <script>
        // Chart instances
        let costPerUserChart, costCompositionChart, costDriversChart, scaleChart;

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        function formatCurrencyPrecise(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        }

        function updateCharts(data) {
            const ctx1 = document.getElementById('costPerUserChart').getContext('2d');
            const ctx2 = document.getElementById('costCompositionChart').getContext('2d');
            const ctx3 = document.getElementById('costDriversChart').getContext('2d');
            const ctx4 = document.getElementById('scaleChart').getContext('2d');

            // Destroy existing charts if they exist
            if (costPerUserChart) costPerUserChart.destroy();
            if (costCompositionChart) costCompositionChart.destroy();
            if (costDriversChart) costDriversChart.destroy();
            if (scaleChart) scaleChart.destroy();

            // Cost Per User Over Time
            costPerUserChart = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: ['1K Users', '5K Users', '10K Users', '25K Users', '50K Users'],
                    datasets: [{
                        label: 'Year 1',
                        data: data.costPerUserByScale.year1,
                        borderColor: '#1976D2',
                        backgroundColor: 'rgba(25, 118, 210, 0.1)',
                        tension: 0.1
                    }, {
                        label: 'Year 2',
                        data: data.costPerUserByScale.year2,
                        borderColor: '#388E3C',
                        backgroundColor: 'rgba(56, 142, 60, 0.1)',
                        tension: 0.1
                    }, {
                        label: 'Year 3',
                        data: data.costPerUserByScale.year3,
                        borderColor: '#D32F2F',
                        backgroundColor: 'rgba(211, 47, 47, 0.1)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + formatCurrencyPrecise(context.parsed.y);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toFixed(2);
                                }
                            }
                        }
                    }
                }
            });

            // Cost Composition Chart
            costCompositionChart = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: ['Year 1', 'Year 2', 'Year 3'],
                    datasets: [{
                        label: 'Development',
                        data: data.costComposition.development,
                        backgroundColor: '#1976D2'
                    }, {
                        label: 'Infrastructure',
                        data: data.costComposition.infrastructure,
                        backgroundColor: '#388E3C'
                    }, {
                        label: 'AWS Services',
                        data: data.costComposition.aws,
                        backgroundColor: '#F57C00'
                    }, {
                        label: 'Graph Database',
                        data: data.costComposition.graphDB,
                        backgroundColor: '#7B1FA2'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true,
                        },
                        y: {
                            stacked: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toFixed(2);
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + formatCurrencyPrecise(context.parsed.y) + '/user';
                                }
                            }
                        }
                    }
                }
            });

            // Cost Drivers Chart
            costDriversChart = new Chart(ctx3, {
                type: 'bar',
                data: {
                    labels: data.costDrivers.labels,
                    datasets: [{
                        label: 'Cost per User Impact',
                        data: data.costDrivers.values,
                        backgroundColor: [
                            '#1976D2',
                            '#388E3C',
                            '#F57C00',
                            '#7B1FA2',
                            '#D32F2F',
                            '#00796B',
                            '#5D4037',
                            '#455A64'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return formatCurrencyPrecise(context.parsed.x) + '/user/month';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toFixed(2);
                                }
                            }
                        }
                    }
                }
            });

            // Scale Chart
            scaleChart = new Chart(ctx4, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Year 1',
                        data: data.scaleData.year1,
                        backgroundColor: 'rgba(25, 118, 210, 0.6)',
                        borderColor: '#1976D2',
                        pointRadius: 8
                    }, {
                        label: 'Year 2',
                        data: data.scaleData.year2,
                        backgroundColor: 'rgba(56, 142, 60, 0.6)',
                        borderColor: '#388E3C',
                        pointRadius: 8
                    }, {
                        label: 'Year 3',
                        data: data.scaleData.year3,
                        backgroundColor: 'rgba(211, 47, 47, 0.6)',
                        borderColor: '#D32F2F',
                        pointRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + 
                                           context.parsed.x.toLocaleString() + ' users, ' +
                                           formatCurrency(context.parsed.y) + '/month';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Number of Users'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Total Monthly Cost'
                            },
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        function calculateTCO() {
            // Get all input values
            const numExperts = parseFloat(document.getElementById('numExperts').value);
            const numEngineers = parseFloat(document.getElementById('numEngineers').value);
            const numFrontendEngineers = parseFloat(document.getElementById('numFrontendEngineers').value);
            const expertRate = parseFloat(document.getElementById('expertRate').value);
            const engineerRate = parseFloat(document.getElementById('engineerRate').value);
            const frontendRate = parseFloat(document.getElementById('frontendRate').value);
            const expertHours = parseFloat(document.getElementById('expertHours').value);
            const engineerHours = parseFloat(document.getElementById('engineerHours').value);
            const frontendHours = parseFloat(document.getElementById('frontendHours').value);
            const mvpDuration = parseFloat(document.getElementById('mvpDuration').value);
            const workingDays = parseFloat(document.getElementById('workingDays').value);
            const expectedUsers = parseFloat(document.getElementById('expectedUsers').value);
            const numOrganizations = parseFloat(document.getElementById('numOrganizations').value);
            
            // Graph Database variables
            const graphDbOption = document.getElementById('graphDbOption').value;
            const orgsPerInstance = parseFloat(document.getElementById('orgsPerInstance').value);
            const neo4jInstanceCost = parseFloat(document.getElementById('neo4jInstanceCost').value);
            const organizationGrowth = parseFloat(document.getElementById('organizationGrowth').value) / 100;
            
            // Ongoing maintenance variables
            const expertMaintenanceHours = parseFloat(document.getElementById('expertMaintenanceHours').value);
            const engineerMaintenanceHours = parseFloat(document.getElementById('engineerMaintenanceHours').value);
            const frontendMaintenanceHours = parseFloat(document.getElementById('frontendMaintenanceHours').value);
            const maintenanceRateMultiplier = parseFloat(document.getElementById('maintenanceRateMultiplier').value) / 100;
            
            const hosting = parseFloat(document.getElementById('hosting').value);
            const devTools = parseFloat(document.getElementById('devTools').value);
            const thirdParty = parseFloat(document.getElementById('thirdParty').value);
            const licensing = parseFloat(document.getElementById('licensing').value);
            const hostingGrowth = parseFloat(document.getElementById('hostingGrowth').value) / 100;
            const supportGrowth = parseFloat(document.getElementById('supportGrowth').value) / 100;
            const licensingGrowth = parseFloat(document.getElementById('licensingGrowth').value) / 100;
            
            // AWS Services variables
            const dynamodbCost = parseFloat(document.getElementById('dynamodbCost').value);
            const cognitoCostPerUser = parseFloat(document.getElementById('cognitoCostPerUser').value);
            const lambdaRequestsPerMonth = parseFloat(document.getElementById('lambdaRequestsPerMonth').value);
            const lambdaCostPerMillion = parseFloat(document.getElementById('lambdaCostPerMillion').value);
            const userGrowth = parseFloat(document.getElementById('userGrowth').value) / 100;
            
            // Additional AWS Services
            const apiGatewayRequests = parseFloat(document.getElementById('apiGatewayRequests').value);
            const apiGatewayCostPerMillion = parseFloat(document.getElementById('apiGatewayCostPerMillion').value);
            const cloudFrontData = parseFloat(document.getElementById('cloudFrontData').value);
            const cloudFrontCostPerGB = parseFloat(document.getElementById('cloudFrontCostPerGB').value);
            const s3Storage = parseFloat(document.getElementById('s3Storage').value);
            const s3CostPerGB = parseFloat(document.getElementById('s3CostPerGB').value);
            const cloudWatchLogs = parseFloat(document.getElementById('cloudWatchLogs').value);
            const cloudWatchCostPerGB = parseFloat(document.getElementById('cloudWatchCostPerGB').value);
            const eventBridgeEvents = parseFloat(document.getElementById('eventBridgeEvents').value);
            const eventBridgeCostPerMillion = parseFloat(document.getElementById('eventBridgeCostPerMillion').value);
            const sqsMessages = parseFloat(document.getElementById('sqsMessages').value);
            const sqsCostPerMillion = parseFloat(document.getElementById('sqsCostPerMillion').value);
            
            // Growth rates
            const lambdaGrowth = parseFloat(document.getElementById('lambdaGrowth').value) / 100;
            const storageGrowth = parseFloat(document.getElementById('storageGrowth').value) / 100;
            const dataTransferGrowth = parseFloat(document.getElementById('dataTransferGrowth').value) / 100;
            const logsGrowth = parseFloat(document.getElementById('logsGrowth').value) / 100;
            
            // User behavior
            const apiRequestsPerUser = parseFloat(document.getElementById('apiRequestsPerUser').value);
            const dataPerUser = parseFloat(document.getElementById('dataPerUser').value);
            const storagePerUser = parseFloat(document.getElementById('storagePerUser').value);
            const activeUserRate = parseFloat(document.getElementById('activeUserRate').value) / 100;

            // Calculate time factors
            const expertTimeFactor = expertHours / 40;
            const engineerTimeFactor = engineerHours / 40;
            const frontendTimeFactor = frontendHours / 40;

            // Calculate MVP costs
            const mvpExpertCost = expertRate * workingDays * mvpDuration * expertTimeFactor * numExperts;
            const mvpEngineerCost = engineerRate * workingDays * mvpDuration * engineerTimeFactor * numEngineers;
            const mvpFrontendCost = frontendRate * workingDays * mvpDuration * frontendTimeFactor * numFrontendEngineers;
            const mvpTotal = mvpExpertCost + mvpEngineerCost + mvpFrontendCost;

            // Calculate maintenance hourly rates
            const maintenanceExpertHourlyRate = (expertRate / 8) * maintenanceRateMultiplier;
            const maintenanceEngineerHourlyRate = (engineerRate / 8) * maintenanceRateMultiplier;
            const maintenanceFrontendHourlyRate = (frontendRate / 8) * maintenanceRateMultiplier;

            // Calculate base monthly maintenance costs
            const baseMaintenanceMonthly = (maintenanceExpertHourlyRate * expertMaintenanceHours * numExperts) + 
                                         (maintenanceEngineerHourlyRate * engineerMaintenanceHours * numEngineers) + 
                                         (maintenanceFrontendHourlyRate * frontendMaintenanceHours * numFrontendEngineers);
            
            // Year 1-3 Development costs
            const year1Maintenance = baseMaintenanceMonthly * (12 - mvpDuration);
            const year1Development = mvpTotal + year1Maintenance;
            const year2Development = baseMaintenanceMonthly * 12 * (1 + supportGrowth);
            const year3Development = baseMaintenanceMonthly * 12 * Math.pow(1 + supportGrowth, 2);

            // Infrastructure costs
            const year1Hosting = hosting * 12;
            const year2Hosting = hosting * 12 * (1 + hostingGrowth);
            const year3Hosting = hosting * 12 * Math.pow(1 + hostingGrowth, 2);

            const year1ThirdParty = thirdParty * 12;
            const year2ThirdParty = thirdParty * 12 * 1.1;
            const year3ThirdParty = thirdParty * 12 * 1.21;

            const year1Licensing = licensing * 12;
            const year2Licensing = licensing * 12 * (1 + licensingGrowth);
            const year3Licensing = licensing * 12 * Math.pow(1 + licensingGrowth, 2);

            const annualDevTools = devTools;

            // Graph Database costs
            const calculateNeo4jInstances = (orgs) => Math.ceil(orgs / orgsPerInstance);
            
            let year1GraphDB = 0, year2GraphDB = 0, year3GraphDB = 0;
            
            if (graphDbOption === 'paid') {
                const year1Orgs = numOrganizations;
                const year2Orgs = numOrganizations * (1 + organizationGrowth);
                const year3Orgs = numOrganizations * Math.pow(1 + organizationGrowth, 2);
                
                const year1Instances = calculateNeo4jInstances(year1Orgs);
                const year2Instances = calculateNeo4jInstances(year2Orgs);
                const year3Instances = calculateNeo4jInstances(year3Orgs);
                
                year1GraphDB = year1Instances * neo4jInstanceCost;
                year2GraphDB = year2Instances * neo4jInstanceCost;
                year3GraphDB = year3Instances * neo4jInstanceCost;
            }

            // AWS Services costs with all new services
            const year1Users = expectedUsers;
            const year2Users = expectedUsers * (1 + userGrowth);
            const year3Users = expectedUsers * Math.pow(1 + userGrowth, 2);
            
            // Year 1 AWS costs
            const year1DynamoDB = dynamodbCost * 12;
            const year1Cognito = cognitoCostPerUser * year1Users * 12;
            const year1Lambda = lambdaCostPerMillion * lambdaRequestsPerMonth * 12;
            const year1ApiGateway = apiGatewayCostPerMillion * apiGatewayRequests * 12;
            const year1CloudFront = cloudFrontCostPerGB * cloudFrontData * 12;
            const year1S3 = s3CostPerGB * s3Storage * 12;
            const year1CloudWatch = cloudWatchCostPerGB * cloudWatchLogs * 12;
            const year1EventBridge = eventBridgeCostPerMillion * eventBridgeEvents * 12;
            const year1SQS = sqsCostPerMillion * sqsMessages * 12;
            
            const year1AWSTotal = year1DynamoDB + year1Cognito + year1Lambda + year1ApiGateway + 
                                year1CloudFront + year1S3 + year1CloudWatch + year1EventBridge + year1SQS;

            // Year 2 AWS costs
            const year2DynamoDB = dynamodbCost * 12 * (1 + storageGrowth);
            const year2Cognito = cognitoCostPerUser * year2Users * 12;
            const year2Lambda = lambdaCostPerMillion * lambdaRequestsPerMonth * 12 * (1 + lambdaGrowth);
            const year2ApiGateway = apiGatewayCostPerMillion * apiGatewayRequests * 12 * (1 + lambdaGrowth);
            const year2CloudFront = cloudFrontCostPerGB * cloudFrontData * 12 * (1 + dataTransferGrowth);
            const year2S3 = s3CostPerGB * s3Storage * 12 * (1 + storageGrowth);
            const year2CloudWatch = cloudWatchCostPerGB * cloudWatchLogs * 12 * (1 + logsGrowth);
            const year2EventBridge = eventBridgeCostPerMillion * eventBridgeEvents * 12 * (1 + lambdaGrowth);
            const year2SQS = sqsCostPerMillion * sqsMessages * 12 * (1 + lambdaGrowth);
            
            const year2AWSTotal = year2DynamoDB + year2Cognito + year2Lambda + year2ApiGateway + 
                                year2CloudFront + year2S3 + year2CloudWatch + year2EventBridge + year2SQS;

            // Year 3 AWS costs
            const year3DynamoDB = dynamodbCost * 12 * Math.pow(1 + storageGrowth, 2);
            const year3Cognito = cognitoCostPerUser * year3Users * 12;
            const year3Lambda = lambdaCostPerMillion * lambdaRequestsPerMonth * 12 * Math.pow(1 + lambdaGrowth, 2);
            const year3ApiGateway = apiGatewayCostPerMillion * apiGatewayRequests * 12 * Math.pow(1 + lambdaGrowth, 2);
            const year3CloudFront = cloudFrontCostPerGB * cloudFrontData * 12 * Math.pow(1 + dataTransferGrowth, 2);
            const year3S3 = s3CostPerGB * s3Storage * 12 * Math.pow(1 + storageGrowth, 2);
            const year3CloudWatch = cloudWatchCostPerGB * cloudWatchLogs * 12 * Math.pow(1 + logsGrowth, 2);
            const year3EventBridge = eventBridgeCostPerMillion * eventBridgeEvents * 12 * Math.pow(1 + lambdaGrowth, 2);
            const year3SQS = sqsCostPerMillion * sqsMessages * 12 * Math.pow(1 + lambdaGrowth, 2);
            
            const year3AWSTotal = year3DynamoDB + year3Cognito + year3Lambda + year3ApiGateway + 
                                year3CloudFront + year3S3 + year3CloudWatch + year3EventBridge + year3SQS;

            // Calculate totals
            const year1Total = year1Development + year1Hosting + year1ThirdParty + year1Licensing + annualDevTools + year1AWSTotal + year1GraphDB;
            const year2Total = year2Development + year2Hosting + year2ThirdParty + year2Licensing + annualDevTools + year2AWSTotal + year2GraphDB;
            const year3Total = year3Development + year3Hosting + year3ThirdParty + year3Licensing + annualDevTools + year3AWSTotal + year3GraphDB;
            const threeYearTotal = year1Total + year2Total + year3Total;

            // Calculate per-user costs
            const avgUsers = (year1Users + year2Users + year3Users) / 3;
            const costPerUser = avgUsers > 0 ? threeYearTotal / avgUsers : 0;
            const monthlyCostPerUser = avgUsers > 0 ? threeYearTotal / (avgUsers * 36) : 0;

            // Calculate data for charts
            const calculateCostPerUserAtScale = (userCount, year) => {
                const yearTotal = year === 1 ? year1Total : year === 2 ? year2Total : year3Total;
                const yearUsers = year === 1 ? year1Users : year === 2 ? year2Users : year3Users;
                const scaleFactor = userCount / yearUsers;
                
                // Fixed costs remain the same, variable costs scale
                const fixedCosts = (year === 1 ? year1Development : year === 2 ? year2Development : year3Development) +
                                 (year === 1 ? year1Hosting : year === 2 ? year2Hosting : year3Hosting) +
                                 (year === 1 ? year1ThirdParty : year === 2 ? year2ThirdParty : year3ThirdParty) +
                                 (year === 1 ? year1Licensing : year === 2 ? year2Licensing : year3Licensing) +
                                 annualDevTools +
                                 (year === 1 ? year1GraphDB : year === 2 ? year2GraphDB : year3GraphDB);
                
                const variableCosts = (year === 1 ? year1AWSTotal : year === 2 ? year2AWSTotal : year3AWSTotal) * scaleFactor;
                
                return (fixedCosts + variableCosts) / userCount / 12;
            };

            const chartData = {
                costPerUserByScale: {
                    year1: [1000, 5000, 10000, 25000, 50000].map(u => calculateCostPerUserAtScale(u, 1)),
                    year2: [1000, 5000, 10000, 25000, 50000].map(u => calculateCostPerUserAtScale(u, 2)),
                    year3: [1000, 5000, 10000, 25000, 50000].map(u => calculateCostPerUserAtScale(u, 3))
                },
                costComposition: {
                    development: [
                        year1Development / year1Users / 12,
                        year2Development / year2Users / 12,
                        year3Development / year3Users / 12
                    ],
                    infrastructure: [
                        (year1Hosting + year1ThirdParty + year1Licensing + annualDevTools) / year1Users / 12,
                        (year2Hosting + year2ThirdParty + year2Licensing + annualDevTools) / year2Users / 12,
                        (year3Hosting + year3ThirdParty + year3Licensing + annualDevTools) / year3Users / 12
                    ],
                    aws: [
                        year1AWSTotal / year1Users / 12,
                        year2AWSTotal / year2Users / 12,
                        year3AWSTotal / year3Users / 12
                    ],
                    graphDB: [
                        year1GraphDB / year1Users / 12,
                        year2GraphDB / year2Users / 12,
                        year3GraphDB / year3Users / 12
                    ]
                },
                costDrivers: {
                    labels: ['Development Team', 'AWS Services', 'Graph Database', 'Infrastructure', 'Licensing', 'Dev Tools'],
                    values: [
                        (year1Development + year2Development + year3Development) / (avgUsers * 36),
                        (year1AWSTotal + year2AWSTotal + year3AWSTotal) / (avgUsers * 36),
                        (year1GraphDB + year2GraphDB + year3GraphDB) / (avgUsers * 36),
                        (year1Hosting + year2Hosting + year3Hosting + year1ThirdParty + year2ThirdParty + year3ThirdParty) / (avgUsers * 36),
                        (year1Licensing + year2Licensing + year3Licensing) / (avgUsers * 36),
                        (annualDevTools * 3) / (avgUsers * 36)
                    ].sort((a, b) => b - a)
                },
                scaleData: {
                    year1: [1000, 5000, 10000, 25000, 50000].map(u => ({
                        x: u,
                        y: (year1Total / year1Users) * u / 12
                    })),
                    year2: [1000, 5000, 10000, 25000, 50000].map(u => ({
                        x: u,
                        y: (year2Total / year2Users) * u / 12
                    })),
                    year3: [1000, 5000, 10000, 25000, 50000].map(u => ({
                        x: u,
                        y: (year3Total / year3Users) * u / 12
                    }))
                }
            };

            // Sort cost drivers and their labels together
            const sortedDrivers = chartData.costDrivers.labels
                .map((label, i) => ({ label, value: chartData.costDrivers.values[i] }))
                .sort((a, b) => b.value - a.value);
            chartData.costDrivers.labels = sortedDrivers.map(d => d.label);
            chartData.costDrivers.values = sortedDrivers.map(d => d.value);

            updateCharts(chartData);

            // Update summary
            document.getElementById('totalTCO').textContent = formatCurrency(threeYearTotal);
            document.getElementById('costPerUser').textContent = formatCurrencyPrecise(costPerUser);
            document.getElementById('monthlyCostPerUser').textContent = formatCurrencyPrecise(monthlyCostPerUser);

            // Update user analysis table
            const userSegments = [
                { name: 'First 1,000 users', count: 1000 },
                { name: '1,001-5,000 users', count: 5000 },
                { name: '5,001-10,000 users', count: 10000 },
                { name: '10,001-25,000 users', count: 25000 },
                { name: '25,001+ users', count: 50000 }
            ];

            const userAnalysisBody = document.getElementById('userAnalysisBody');
            userAnalysisBody.innerHTML = userSegments.map(segment => {
                const fixedCostPerUser = ((year1Development + year2Development + year3Development) / 3 + 
                                         (year1Hosting + year2Hosting + year3Hosting) / 3 +
                                         (year1ThirdParty + year2ThirdParty + year3ThirdParty) / 3 +
                                         (year1Licensing + year2Licensing + year3Licensing) / 3 +
                                         annualDevTools +
                                         (year1GraphDB + year2GraphDB + year3GraphDB) / 3) / segment.count / 12;
                
                const variableCostPerUser = ((year1AWSTotal + year2AWSTotal + year3AWSTotal) / 3) / avgUsers / 12;
                const totalCostPerUser = fixedCostPerUser + variableCostPerUser;
                const efficiency = ((totalCostPerUser / monthlyCostPerUser - 1) * 100).toFixed(1);
                const efficiencyClass = efficiency < 0 ? 'positive' : 'negative';
                
                return `
                    <tr>
                        <td>${segment.name}</td>
                        <td class="number currency">${formatCurrencyPrecise(fixedCostPerUser)}</td>
                        <td class="number currency">${formatCurrencyPrecise(variableCostPerUser)}</td>
                        <td class="number currency"><strong>${formatCurrencyPrecise(totalCostPerUser)}</strong></td>
                        <td class="number ${efficiencyClass}">${efficiency > 0 ? '+' : ''}${efficiency}%</td>
                    </tr>
                `;
            }).join('');

            // Update detailed table
            const tbody = document.getElementById('tcoBody');
            tbody.innerHTML = `
                <tr>
                    <td><strong>üë®‚Äçüíª Development Team</strong></td>
                    <td class="number currency">${formatCurrency(year1Development)}</td>
                    <td class="number currency">${formatCurrency(year2Development)}</td>
                    <td class="number currency">${formatCurrency(year3Development)}</td>
                    <td class="number currency">${formatCurrency(year1Development + year2Development + year3Development)}</td>
                </tr>
                <tr>
                    <td>&nbsp;&nbsp;‚Ä¢ MVP Development (${mvpDuration} months)</td>
                    <td class="number currency">${formatCurrency(mvpTotal)}</td>
                    <td class="number currency">$0</td>
                    <td class="number currency">$0</td>
                    <td class="number currency">${formatCurrency(mvpTotal)}</td>
                </tr>
                <tr>
                    <td>&nbsp;&nbsp;‚Ä¢ Ongoing Maintenance & Support</td>
                    <td class="number currency">${formatCurrency(year1Maintenance)}</td>
                    <td class="number currency">${formatCurrency(year2Development)}</td>
                    <td class="number currency">${formatCurrency(year3Development)}</td>
                    <td class="number currency">${formatCurrency(year1Maintenance + year2Development + year3Development)}</td>
                </tr>
                <tr>
                    <td><strong>‚òÅÔ∏è Infrastructure & Hosting</strong></td>
                    <td class="number currency">${formatCurrency(year1Hosting)}</td>
                    <td class="number currency">${formatCurrency(year2Hosting)}</td>
                    <td class="number currency">${formatCurrency(year3Hosting)}</td>
                    <td class="number currency">${formatCurrency(year1Hosting + year2Hosting + year3Hosting)}</td>
                </tr>
                <tr>
                    <td><strong>üìÑ Software Licenses</strong></td>
                    <td class="number currency">${formatCurrency(year1Licensing)}</td>
                    <td class="number currency">${formatCurrency(year2Licensing)}</td>
                    <td class="number currency">${formatCurrency(year3Licensing)}</td>
                    <td class="number currency">${formatCurrency(year1Licensing + year2Licensing + year3Licensing)}</td>
                </tr>
                <tr>
                    <td><strong>üï∏Ô∏è Graph Database (${graphDbOption === 'free' ? 'Free Neo4j' : 'Neo4j Discovery'})</strong></td>
                    <td class="number currency">${formatCurrency(year1GraphDB)}</td>
                    <td class="number currency">${formatCurrency(year2GraphDB)}</td>
                    <td class="number currency">${formatCurrency(year3GraphDB)}</td>
                    <td class="number currency">${formatCurrency(year1GraphDB + year2GraphDB + year3GraphDB)}</td>
                </tr>
                <tr>
                    <td><strong>üîß Development Tools & Software</strong></td>
                    <td class="number currency">${formatCurrency(annualDevTools)}</td>
                    <td class="number currency">${formatCurrency(annualDevTools)}</td>
                    <td class="number currency">${formatCurrency(annualDevTools)}</td>
                    <td class="number currency">${formatCurrency(annualDevTools * 3)}</td>
                </tr>
                <tr>
                    <td><strong>üîå Third-party Services</strong></td>
                    <td class="number currency">${formatCurrency(year1ThirdParty)}</td>
                    <td class="number currency">${formatCurrency(year2ThirdParty)}</td>
                    <td class="number currency">${formatCurrency(year3ThirdParty)}</td>
                    <td class="number currency">${formatCurrency(year1ThirdParty + year2ThirdParty + year3ThirdParty)}</td>
                </tr>
                <tr>
                    <td><strong>‚òÅÔ∏è AWS Services Total</strong></td>
                    <td class="number currency">${formatCurrency(year1AWSTotal)}</td>
                    <td class="number currency">${formatCurrency(year2AWSTotal)}</td>
                    <td class="number currency">${formatCurrency(year3AWSTotal)}</td>
                    <td class="number currency">${formatCurrency(year1AWSTotal + year2AWSTotal + year3AWSTotal)}</td>
                </tr>
                <tr>
                    <td>&nbsp;&nbsp;‚Ä¢ DynamoDB</td>
                    <td class="number currency">${formatCurrency(year1DynamoDB)}</td>
                    <td class="number currency">${formatCurrency(year2DynamoDB)}</td>
                    <td class="number currency">${formatCurrency(year3DynamoDB)}</td>
                    <td class="number currency">${formatCurrency(year1DynamoDB + year2DynamoDB + year3DynamoDB)}</td>
                </tr>
                <tr>
                    <td>&nbsp;&nbsp;‚Ä¢ Cognito Authentication</td>
                    <td class="number currency">${formatCurrency(year1Cognito)}</td>
                    <td class="number currency">${formatCurrency(year2Cognito)}</td>
                    <td class="number currency">${formatCurrency(year3Cognito)}</td>
                    <td class="number currency">${formatCurrency(year1Cognito + year2Cognito + year3Cognito)}</td>
                </tr>
                <tr>
                    <td>&nbsp;&nbsp;‚Ä¢ Lambda Functions</td>
                    <td class="number currency">${formatCurrency(year1Lambda)}</td>
                    <td class="number currency">${formatCurrency(year2Lambda)}</td>
                    <td class="number currency">${formatCurrency(year3Lambda)}</td>
                    <td class="number currency">${formatCurrency(year1Lambda + year2Lambda + year3Lambda)}</td>
                </tr>
                <tr>
                    <td>&nbsp;&nbsp;‚Ä¢ API Gateway</td>
                    <td class="number currency">${formatCurrency(year1ApiGateway)}</td>
                    <td class="number currency">${formatCurrency(year2ApiGateway)}</td>
                    <td class="number currency">${formatCurrency(year3ApiGateway)}</td>
                    <td class="number currency">${formatCurrency(year1ApiGateway + year2ApiGateway + year3ApiGateway)}</td>
                </tr>
                <tr>
                    <td>&nbsp;&nbsp;‚Ä¢ CloudFront CDN</td>
                    <td class="number currency">${formatCurrency(year1CloudFront)}</td>
                    <td class="number currency">${formatCurrency(year2CloudFront)}</td>
                    <td class="number currency">${formatCurrency(year3CloudFront)}</td>
                    <td class="number currency">${formatCurrency(year1CloudFront + year2CloudFront + year3CloudFront)}</td>
                </tr>
                <tr>
                    <td>&nbsp;&nbsp;‚Ä¢ S3 Storage</td>
                    <td class="number currency">${formatCurrency(year1S3)}</td>
                    <td class="number currency">${formatCurrency(year2S3)}</td>
                    <td class="number currency">${formatCurrency(year3S3)}</td>
                    <td class="number currency">${formatCurrency(year1S3 + year2S3 + year3S3)}</td>
                </tr>
                <tr>
                    <td>&nbsp;&nbsp;‚Ä¢ CloudWatch Logs</td>
                    <td class="number currency">${formatCurrency(year1CloudWatch)}</td>
                    <td class="number currency">${formatCurrency(year2CloudWatch)}</td>
                    <td class="number currency">${formatCurrency(year3CloudWatch)}</td>
                    <td class="number currency">${formatCurrency(year1CloudWatch + year2CloudWatch + year3CloudWatch)}</td>
                </tr>
                <tr>
                    <td>&nbsp;&nbsp;‚Ä¢ EventBridge</td>
                    <td class="number currency">${formatCurrency(year1EventBridge)}</td>
                    <td class="number currency">${formatCurrency(year2EventBridge)}</td>
                    <td class="number currency">${formatCurrency(year3EventBridge)}</td>
                    <td class="number currency">${formatCurrency(year1EventBridge + year2EventBridge + year3EventBridge)}</td>
                </tr>
                <tr>
                    <td>&nbsp;&nbsp;‚Ä¢ SQS Messaging</td>
                    <td class="number currency">${formatCurrency(year1SQS)}</td>
                    <td class="number currency">${formatCurrency(year2SQS)}</td>
                    <td class="number currency">${formatCurrency(year3SQS)}</td>
                    <td class="number currency">${formatCurrency(year1SQS + year2SQS + year3SQS)}</td>
                </tr>
                <tr class="total-row">
                    <td><strong>üí∞ TOTAL COST</strong></td>
                    <td class="number currency"><strong>${formatCurrency(year1Total)}</strong></td>
                    <td class="number currency"><strong>${formatCurrency(year2Total)}</strong></td>
                    <td class="number currency"><strong>${formatCurrency(year3Total)}</strong></td>
                    <td class="number currency"><strong>${formatCurrency(threeYearTotal)}</strong></td>
                </tr>
            `;

            // Update analysis table
            const analysisBody = document.getElementById('analysisBody');
            const avgMonthlyCost = threeYearTotal / 36;
            const developmentPercentage = ((year1Development + year2Development + year3Development) / threeYearTotal * 100).toFixed(1);
            const mvpPercentage = (mvpTotal / threeYearTotal * 100).toFixed(1);
            const infrastructurePercentage = (((year1Hosting + year2Hosting + year3Hosting) + (year1Licensing + year2Licensing + year3Licensing) + (year1ThirdParty + year2ThirdParty + year3ThirdParty) + (annualDevTools * 3)) / threeYearTotal * 100).toFixed(1);
            const awsPercentage = ((year1AWSTotal + year2AWSTotal + year3AWSTotal) / threeYearTotal * 100).toFixed(1);
            const graphDbPercentage = ((year1GraphDB + year2GraphDB + year3GraphDB) / threeYearTotal * 100).toFixed(1);
            
            const year3Orgs = numOrganizations * Math.pow(1 + organizationGrowth, 2);
            const year3Instances = graphDbOption === 'paid' ? calculateNeo4jInstances(year3Orgs) : 0;
            
            const totalMvpHours = workingDays * mvpDuration * ((expertHours * numExperts) + (engineerHours * numEngineers) + (frontendHours * numFrontendEngineers)) / 5;
            const totalMaintenanceHours = (expertMaintenanceHours * numExperts) + (engineerMaintenanceHours * numEngineers) + (frontendMaintenanceHours * numFrontendEngineers);
            const year3MaintenanceHours = totalMaintenanceHours * Math.pow(1 + supportGrowth, 2);
            
            // Calculate AWS cost per user for different services
            const year3AWSPerUser = year3AWSTotal / year3Users / 12;
            const activeUsers = year3Users * activeUserRate;
            const costPerActiveUser = year3Total / activeUsers / 12;

            analysisBody.innerHTML = `
                <tr>
                    <td>Average Monthly Cost</td>
                    <td class="number currency">${formatCurrency(avgMonthlyCost)}</td>
                </tr>
                <tr>
                    <td>3-Year Cost Per User</td>
                    <td class="number currency">${formatCurrencyPrecise(costPerUser)}</td>
                </tr>
                <tr>
                    <td>Monthly Cost Per User</td>
                    <td class="number currency">${formatCurrencyPrecise(monthlyCostPerUser)}</td>
                </tr>
                <tr>
                    <td>Monthly Cost Per Active User (${(activeUserRate * 100).toFixed(0)}% active)</td>
                    <td class="number currency">${formatCurrencyPrecise(costPerActiveUser)}</td>
                </tr>
                <tr>
                    <td>MVP Cost as % of Total</td>
                    <td class="number">${mvpPercentage}%</td>
                </tr>
                <tr>
                    <td>Development Team as % of Total</td>
                    <td class="number">${developmentPercentage}%</td>
                </tr>
                <tr>
                    <td>Infrastructure & Licenses as % of Total</td>
                    <td class="number">${infrastructurePercentage}%</td>
                </tr>
                <tr>
                    <td>AWS Services as % of Total</td>
                    <td class="number">${awsPercentage}%</td>
                </tr>
                <tr>
                    <td>Graph Database as % of Total</td>
                    <td class="number">${graphDbPercentage}%</td>
                </tr>
                <tr>
                    <td>Graph Database Setup</td>
                    <td class="number">${graphDbOption === 'free' ? 'Free Neo4j (Community)' : 'Paid Neo4j (Discovery)'}</td>
                </tr>
                <tr>
                    <td>Year 3 Projected Organizations</td>
                    <td class="number">${Math.round(year3Orgs).toLocaleString()}</td>
                </tr>
                <tr>
                    <td>Year 3 Neo4j Instances Required</td>
                    <td class="number">${year3Instances}</td>
                </tr>
                <tr>
                    <td>Year 3 Projected Users</td>
                    <td class="number">${Math.round(year3Users).toLocaleString()}</td>
                </tr>
                <tr>
                    <td>AWS Cost Per User (Year 3)</td>
                    <td class="number currency">${formatCurrencyPrecise(year3AWSPerUser)}</td>
                </tr>
                <tr>
                    <td>Infrastructure Efficiency (Year 3)</td>
                    <td class="number currency">${formatCurrencyPrecise((year3Hosting + year3Licensing + year3ThirdParty) / year3Users / 12)}/user/month</td>
                </tr>
                <tr>
                    <td>Total MVP Hours (All Resources)</td>
                    <td class="number">${totalMvpHours.toFixed(0)} hours</td>
                </tr>
                <tr>
                    <td>Monthly Maintenance Hours (Base)</td>
                    <td class="number">${totalMaintenanceHours.toFixed(1)} hours</td>
                </tr>
                <tr>
                    <td>Monthly Maintenance Hours (Year 3)</td>
                    <td class="number">${year3MaintenanceHours.toFixed(1)} hours</td>
                </tr>
                <tr>
                    <td>Total Team Size</td>
                    <td class="number">${numExperts + numEngineers + numFrontendEngineers} developers</td>
                </tr>
                <tr>
                    <td>Team Composition</td>
                    <td class="number">${numExperts} Expert(s), ${numEngineers} Engineer(s), ${numFrontendEngineers} Frontend</td>
                </tr>
                <tr>
                    <td>API Requests per Active User/Month</td>
                    <td class="number">${(apiRequestsPerUser / activeUserRate).toFixed(0)} requests</td>
                </tr>
                <tr>
                    <td>Total API Requests (Year 3)</td>
                    <td class="number">${(apiGatewayRequests * 12 * Math.pow(1 + lambdaGrowth, 2)).toFixed(1)}M requests</td>
                </tr>
            `;
        }

        // Initial calculation
        calculateTCO();
    </script>
</body>
</html>
